!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("angular"),require("tartan")):"function"==typeof define&&define.amd?define(["angular","tartan"],t):"object"==typeof exports?exports.angularTartan=t(require("angular"),require("tartan")):e.angularTartan=t(e.angular,e.tartan)}(this,function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(1);r.extend(e.exports,n(2)),n(3)},function(t,n){t.exports=e},function(e,t){e.exports={version:"0.5.1"}},function(e,t,n){"use strict";n(4),n(8),n(9),n(10),n(11),n(12),n(13),n(14)},function(e,t,n){"use strict";var r=n(1),i=n(5),s=n(6),o=n(7);o.directive("tartan",[function(){return{restrict:"E",template:"",replace:!1,scope:{source:"@?",schema:"@?",options:"=?"},controller:["$scope",function(e){function t(){var t=i.schema[e.schema]||i.schema.classic;c=t.parse(r.extend({},e.options,{errorHandler:a})),u=t.format(r.extend({},e.options)),l={schema:t,source:null,sett:null,formatted:null,colors:t.colors},n()}function n(){o.emit("tartan.beginUpdate");var t=c(e.source);l=r.extend({},l,{source:e.source,sett:t,formatted:u(t)}),o.emit("tartan.changed",l),o.emit("tartan.endUpdate")}var o=this;o._events=new s,o.emit=r.bind(o._events,o._events.emit),o.on=r.bind(o._events,o._events.addListener),o.off=r.bind(o._events,o._events.removeListener);var a=null,c=null,u=null,l={schema:null,source:null,sett:null,formatted:null,colors:null};this.requestUpdate=function(e){r.isFunction(e)&&e(l)},this.getErrorHandler=function(){return a},this.setErrorHandler=function(e){a=e,t()},t(),e.$watch("schema",function(e,n){e!==n&&t()}),e.$watch("options",function(e,n){e!==n&&t()},!0),e.$watch("source",function(e,t){e!==t&&n()})}]}}])},function(e,n){e.exports=t},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(s(n))for(a=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,c=0;c<i;c++)u[c].apply(this,a);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,o,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";var r=n(5),i=n(1),s=i.module("angular-tartan",[]);s.constant("tartan",r),e.exports=s},function(e,t,n){"use strict";var r=n(1),i=n(5),s=n(7),o=/^([\s\S]*?)\/([\s\S]*?)\/([\s\S]*)$/;s.directive("tartanImage",[function(){return{restrict:"E",template:"<canvas></canvas>",replace:!0,scope:{source:"@?",width:"@?",height:"@?",renderer:"@?",zoom:"@?"},link:function(e,t){function n(t){t=r.isString(t)?t:"";var n=o.exec(t);t=n?[n[3],n[2],n[1]]:[t,"",""];var s=i.schema[t.pop().toLowerCase()]||null;r.isObject(s)||(s=i.schema.classic);var a=t.pop().split(",").map(function(e){return e=parseInt(e,10),e>0?e:0}).filter(function(e){return e>0});t=t.join("/");var l=s.parse()(t),f={zoom:e.zoom,weave:a,defaultColors:s.colors,transformSyntaxTree:i.transform.flatten()},h=i.render[e.renderer];if(!r.isFunction(h)){h=null;for(var v in i.render)if(r.isFunction(i.render[v])&&i.render[v].id==e.renderer){h=i.render[v];break}r.isFunction(h)||(h=i.render.canvas)}c=h(l,f),u.width=c.metrics.warp.length,u.height=c.metrics.weft.length}function s(){var t,n,r=(""+e.width).toLowerCase(),i=(""+e.height).toLowerCase();"source"==r?t=u.width:"auto"!=r&&(t=parseFloat(e.width)||a.offsetWidth),"source"==i?n=u.height:"auto"!=i&&(n=parseFloat(e.height)||a.offsetHeight),"auto"==r&&"auto"==i?(t=a.offsetWidth,n=a.offsetHeight):"auto"==r?t=n*u.width/u.height:"auto"==i&&(n=t*u.height/u.width),t=Math.ceil(t),n=Math.ceil(n),a.width!=t&&(a.width=t),a.height!=n&&(a.height=n),l()}var a=t.get(0),c=null,u={width:0,height:0},l=i.utils.repaint(function(){c(a,{x:0,y:0},!0)});["source","zoom","renderer"].forEach(function(t){e.$watch(t,function(t,r){t!==r&&(n(e.source),s())},!0)}),["width","height"].forEach(function(t){e.$watch(t,function(e,t){e!==t&&s()},!0)}),n(e.source),s()}}}])},function(e,t,n){"use strict";function r(e,t,n,r){function i(n){n=n||e.event,n.target===t&&1==n.buttons&&(n.preventDefault(),u={x:n.clientX,y:n.clientY},n.target&&n.target.setCapture&&n.target.setCapture())}function s(t){if(t=t||e.event,u){if(1!=t.buttons)u=null,c.releaseCapture&&c.releaseCapture();else{var i=n();i.x+=t.clientX-u.x,i.y+=t.clientY-u.y,u.x=t.clientX,u.y=t.clientY,t.preventDefault()}r()}}function o(t){t=t||e.event,1==t.buttons&&(u=null,c.releaseCapture&&c.releaseCapture()),r()}function a(){u=null}var c=e.document,u=null,l=c.releaseCapture?t:e;return l.addEventListener("mousedown",i),l.addEventListener("mousemove",s),l.addEventListener("mouseup",o),t.addEventListener("losecapture",a),function(){l.removeEventListener("mousedown",i),l.removeEventListener("mousemove",s),l.removeEventListener("mouseup",o),t.removeEventListener("losecapture",a)}}function i(e,t){function n(){s.isFunction(t)&&t()}return e.addEventListener("resize",n),function(){e.removeEventListener("mousedown",n)}}var s=n(1),o=n(5),a=n(7);a.directive("tartanPreviewControl",["$window","$timeout",function(e,t){return{restrict:"E",require:"^^tartan",template:'<div class="tartan-preview-control"><canvas></canvas></div>',replace:!0,scope:{weave:"=?",repeat:"=?",offset:"=?",metrics:"=?",interactive:"=?",zoom:"=?",renderer:"=?"},link:function(n,a,c,u){function l(){n.offset=s.extend({},_)}function f(){var e={zoom:n.zoom,weave:n.weave,defaultColors:w.colors,transformSyntaxTree:o.transform.flatten()},t=o.render[n.renderer];if(!s.isFunction(t)){t=null;for(var r in o.render)if(s.isFunction(o.render[r])&&o.render[r].id==n.renderer){t=o.render[r];break}s.isFunction(t)||(t=o.render.canvas)}g=t(w.sett,e),n.metrics=g.metrics,v()}function h(e){w=e,f(),n.$applyAsync()}function v(){var e=Math.ceil(m.offsetWidth),t=Math.ceil(m.offsetHeight);d.css({position:"absolute",left:"0px",top:"0px",width:e+"px",height:t+"px"}),p.width!=e&&(p.width=e),p.height!=t&&(p.height=t),y()}a.css({position:"relative"});var d=a.find("canvas"),p=d.get(0),m=d.parent().get(0),g=null,w=null,_={x:0,y:0};n.interactiveOptions={resize:!1,drag:!1};var y=o.utils.repaint(function(){n.interactive||(_={x:0,y:0}),_=g(p,_,!!n.repeat),t(l)});u.on("tartan.changed",h),u.requestUpdate(h),["weave","repeat","zoom","renderer"].forEach(function(e){n.$watch(e,function(e,t){e!==t&&f()},!0)}),n.$watch("offset",function(e,t){if(e!==t){var n=s.extend({},_,e);n.x==_.x&&n.y==_.y||(_=n,y())}},!0);var E=null,x=null;n.$watch("interactive",function(){var t=s.extend({resize:!1,drag:!1},n.interactive===!0?{resize:!0,drag:!0}:n.interactive);n.interactiveOptions=t;var o=[];t.resize?E||(E=i(e,v)):E&&(o.push(E),E=null),t.drag?x||(x=r(e,p,function(){return _},y)):x&&(o.push(x),x=null),y(),o.forEach(function(e){e()})}),n.$on("$destroy",function(){u.off("tartan.changed",h),x&&x(),E&&E()})}}}])},function(e,t,n){"use strict";var r=n(7);r.directive("tartanFormatted",[function(){return{restrict:"E",require:"^^tartan",template:"<pre></pre>",replace:!0,scope:{},link:function(e,t,n,r){function i(e){t.text(e.formatted)}r.on("tartan.changed",i),r.requestUpdate(i),e.$on("$destroy",function(){r.off("tartan.changed",i)})}}}])},function(e,t,n){"use strict";var r=n(1),i=n(7);i.directive("tartanErrorHandlerConsole",[function(){return{restrict:"E",require:"^^tartan",template:"",replace:!1,scope:{},link:function(e,t,n,i){function s(e,t,n){var r=o[n]||a;r&&console[r](e)}var o={},a=null;r.isObject(console)&&(a=r.isFunction(console.trace)?"trace":"log",r.isFunction(console.error)&&(o.error="error"),r.isFunction(console.warn)&&(o.warning="warn"),r.isFunction(console.info)&&(o.notice="info")),i.setErrorHandler(s),e.$on("$destroy",function(){i.getErrorHandler===s&&i.setErrorHandler(null)})}}}])},function(e,t,n){"use strict";var r=n(7);r.directive("tartanErrorHandlerThrow",[function(){return{restrict:"E",require:"^^tartan",template:"",replace:!1,scope:{},link:function(e,t,n,r){function i(e,t,n){throw e instanceof Error&&(e.data=t,e.severity=n),e}r.setErrorHandler(i),e.$on("$destroy",function(){r.getErrorHandler===i&&r.setErrorHandler(null)})}}}])},function(e,t,n){"use strict";var r=n(7);r.directive("tartanErrorHandlerCollect",[function(){return{restrict:"E",require:"^^tartan",template:"",replace:!1,scope:{model:"=?"},link:function(e,t,n,r){function i(e,t,n){e instanceof Error&&(e.data=t,e.severity=n),s.push(e)}var s=[];r.setErrorHandler(i),r.on("tartan.beginUpdate",function(){s=[],e.model=s,e.$applyAsync()}),r.on("tartan.endUpdate",function(){e.model=s,s=[],e.$applyAsync()}),e.$on("$destroy",function(){r.getErrorHandler===i&&r.setErrorHandler(null)})}}}])},function(e,t,n){"use strict";var r=n(7);r.directive("tartanErrorHandlerCustom",[function(){return{restrict:"E",require:"^^tartan",template:"",replace:!1,scope:{handler:"=?"},link:function(e,t,n,r){e.$watch("handler",function(t,n){t!==n&&r.setErrorHandler(e.handler)}),r.setErrorHandler(e.handler),e.$on("$destroy",function(){r.getErrorHandler===e.handler&&r.setErrorHandler(null)})}}}])}])});
//# sourceMappingURL=angular-tartan.min.js.map