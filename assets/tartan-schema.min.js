!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_"),require("tartan")):"function"==typeof define&&define.amd?define(["_","tartan"],e):"object"==typeof exports?exports.tartanSchema=e(require("_"),require("tartan")):r.tartanSchema=e(r._,r.tartan)}(this,function(r,e){return function(r){function e(o){if(t[o])return t[o].exports;var n=t[o]={exports:{},id:o,loaded:!1};return r[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var t={};return e.m=r,e.c=t,e.p="",e(0)}([function(r,e,t){"use strict";var o=t(1),n=t(2);o.extend(r.exports,t(3)),r.exports.syntax=t(4),r.exports.schema=t(7),o.extend(n.syntax,r.exports.syntax),o.extend(n.schema,r.exports.schema)},function(e,t){e.exports=r},function(r,t){r.exports=e},function(r,e){r.exports={version:"1.0.0"}},function(r,e,t){"use strict";r.exports.extended=t(5),r.exports.weddslist=t(6)},function(r,e,t){"use strict";function o(r,e){return f.token.isOpeningSquareBracket(r)&&f.token.isClosingSquareBracket(e)||f.token.isOpeningParenthesis(r)&&f.token.isClosingParenthesis(e)}function n(r,e){var t,n,a=[{isRegularBlock:!0,items:[]}];for(l.each(r,function(r){if(r.isStripe)return t=l.last(a),void t.items.push(f.node.newStripe(r));if(r.isPivot)return t=l.last(a),void(t.isPivotBlock?(t.items.push(f.node.newStripe(r)),a.pop(),n=l.last(a),n.items.push(f.node.newBlock(t.items,!0))):a.push({isPivotBlock:!0,token:r,items:[f.node.newStripe(r)]}));if((r.isBlockStart||r.isBlockEnd)&&(t=l.last(a),t.isPivotBlock&&(e.errorHandler(new Error(f.error.message.orphanedPivot),{token:t.token},f.error.severity.warning),a.pop(),n=l.last(a),[].push.apply(n.items,t.items))),r.isBlockStart)return void a.push({isRegularBlock:!0,token:r,items:[]});if(r.isBlockEnd){if(a.length>1){if(t=a.pop(),o(t.token,r))return void(t.items.length>0&&(n=l.last(a),n.items.push(f.node.newBlock(t.items,f.token.isClosingSquareBracket(r),t.token.repeat*r.repeat))));a.push(t)}return void e.errorHandler(new Error(f.error.message.unmatchedBlockEnd),{token:r},f.error.severity.error)}e.errorHandler(new Error(f.error.message.unexpectedToken),{token:r},f.error.severity.error)});a.length>1;)t=a.pop(),n=l.last(a),t.items.length>0&&[].push.apply(n.items,t.items),t.isPivotBlock?e.errorHandler(new Error(f.error.message.orphanedPivot),{token:t.token},f.error.severity.warning):e.errorHandler(new Error(f.error.message.unmatchedBlockStart),{token:t.token},f.error.severity.error);t=l.first(a).items;var s=!1;return 1==t.length&&t[0].isBlock&&t[0].reflect&&(s=!0,t=t[0].items),f.node.newRootBlock(t,s)}function a(r,e){return l.chain(r).reduce(function(r,t){if(t.isRepeat&&t.isSuffix){var o=r.pop();o?(o=l.clone(o),o.repeat=o.repeat>1?o.repeat:1,o.repeat*=t.count,r.push(o)):e.errorHandler(new Error(f.error.message.unexpectedToken),{token:t},f.error.severity.error)}else t=l.clone(t),t.repeat=t.repeat>1?t.repeat:1,r.push(t);return r},[]).reduceRight(function(r,t){if(t.isRepeat&&t.isPrefix){var o=r.pop();o?(o=l.clone(o),o.repeat=o.repeat>1?o.repeat:1,o.repeat*=t.count,r.push(o)):e.errorHandler(new Error(f.error.message.unexpectedToken),{token:t},f.error.severity.error)}else t=l.clone(t),t.repeat=t.repeat>1?t.repeat:1,r.push(t);return r},[]).reverse().map(function(r){return(r.isStripe||r.isPivot)&&r.repeat>1&&(r=l.clone(r),r.count*=r.repeat,r.repeat=1),r}).value()}function s(r,e){if(!l.isArray(r))return r;if(l.isFunction(e.processTokens)&&(r=e.processTokens(r),!l.isArray(r)))return r;var t=[],o=[],s=[],i=o;l.each(r,function(r){return r.isColor?void t.push(r):void(r.isWarpAndWeftSeparator?(i===s&&e.errorHandler(new Error(f.error.message.multipleWarpAnWeftSeparator),{token:r},f.error.severity.warning),i=s):i.push(r))}),o=a(o,e),s=a(s,e),0==o.length&&(o=s,s=[]),0==s.length&&(s=o);var p={};return p.colors=f.color.buildColorMap(t),p.warp=n(o,e),s===o?p.weft=p.warp:p.weft=n(s,e),l.isFunction(e.transformSyntaxTree)&&(p=e.transformSyntaxTree(p)),p}function i(r){return r=l.extend({},p,r),l.isFunction(r.errorHandler)||(r.errorHandler=p.errorHandler),function(e){return s(e,r)}}var l=t(1),f=t(2).utils,p={errorHandler:function(r,e,t){},processTokens:null,transformSyntaxTree:null};r.exports=i},function(r,e,t){"use strict";function o(r,e){var t,o,n=!1;r=l.filter(r,function(r){return!r.isWarpStart&&!r.isWeftStart}),r.length>=2&&(t=l.first(r),o=l.last(r),t.isBlockBodyStart&&o.isBlockBodyEnd?(r.splice(0,1),r.splice(-1,1)):(t.isBlockBodyStart&&(e.errorHandler(new Error(f.error.message.unexpectedToken),{token:t},f.error.severity.error),r.splice(0,1)),o.isBlockBodyStart&&(e.errorHandler(new Error(f.error.message.unexpectedToken),{token:o},f.error.severity.error),r.splice(-1,1)))),r.length>=4&&(t=l.first(r),o=l.last(r),t.isStripe&&o.isStripe&&(t=r[1],o=r[r.length-2],t.isBlockBodyStart&&o.isBlockBodyEnd&&(n=!0,r.splice(1,1),r.splice(-2,1))));var a=l.chain(r).map(function(r){return r.isStripe?f.node.newStripe(r):(e.errorHandler(new Error(f.error.message.unexpectedToken),{token:r},f.error.severity.error),null)}).filter().value();return a.length<=2&&(n=!1),f.node.newRootBlock(a,n)}function n(r,e,t,o){var n=l.first(r);l.each(r,function(r){return!o(r)&&(r.isWarpStart&&r!==n&&t.errorHandler(new Error(f.error.message.multipleWarpAnWeftSeparator),{token:r},f.error.severity.warning),void e.push(r))})}function a(r,e,t,o){if(0!=r.length){var a,s=!1;a=l.first(r),(a.isWarpStart||a.isStripe||a.isBlockBodyStart)&&(n(r,e,o,function(r){return r.isWeftStart}),r.splice(0,e.length),s=!0),a=l.first(r),a&&a.isWeftStart&&(n(r,t,o,function(r){return r.isWarpStart}),r.splice(0,t.length)),s||(a=l.first(r),a&&a.isWarpStart&&(n(r,e,o,function(r){return r.isWeftStart}),r.splice(0,e.length))),l.each(r,function(r){o.errorHandler(new Error(f.error.message.extraTokenInInputSequence),{token:r},f.error.severity.warning)})}}function s(r,e){if(!l.isArray(r))return r;if(l.isFunction(e.processTokens)&&(r=e.processTokens(r),!l.isArray(r)))return r;var t=l.filter(r,function(r){return r.isColor}),n=[],s=[];a(l.filter(r,function(r){return!r.isColor}),n,s,e),0==n.length&&(n=s,s=[]),0==s.length&&(s=n);var i={};return i.colors=f.color.buildColorMap(t),i.warp=o(n,e),s===n?i.weft=i.warp:i.weft=o(s,e),l.isFunction(e.transformSyntaxTree)&&(i=e.transformSyntaxTree(i)),i}function i(r){return r=l.extend({},p,r),l.isFunction(r.errorHandler)||(r.errorHandler=p.errorHandler),function(e){return s(e,r)}}var l=t(1),f=t(2).utils,p={errorHandler:function(r,e,t){},processTokens:null,transformSyntaxTree:null};r.exports=i},function(r,e,t){"use strict";r.exports.extended=t(8),r.exports.stwr=t(11),r.exports.weddslist=t(14)},function(r,e,t){"use strict";var o=t(2);r.exports.id="extended",r.exports.name="Extended syntax",r.exports.parse=t(9),r.exports.format=t(10),r.exports.colors=o.defaults.colors,r.exports.warpAndWeftSeparator=o.defaults.warpAndWeftSeparator},function(r,e,t){"use strict";function o(r){return r=n.extend({},r),n.isString(r.warpAndWeftSeparator)||(r.warpAndWeftSeparator=""),""==r.warpAndWeftSeparator&&(r.warpAndWeftSeparator=a.warpAndWeftSeparator),s.parse([s.parse.pivot(),s.parse.stripe(),s.parse.literal("["),s.parse.literal("]"),s.parse.literal("("),s.parse.literal(")"),s.parse.literal(r.warpAndWeftSeparator),s.parse.repeat({allowAsPrefix:!0,allowAsSuffix:!0}),s.parse.color({allowLongNames:!0,colorPrefix:/[=]?[#]/,colorSuffix:null,colorFormat:"both",allowComment:!0,commentSuffix:/;/,requireCommentSuffix:!1,commentFormat:/^\s*(.*)\s*;\s*$/})],{errorHandler:r.errorHandler,processTokens:s.filter([r.processTokens,s.filter.removeTokens(s.defaults.insignificantTokens)]),buildSyntaxTree:i({errorHandler:r.errorHandler,processTokens:s.filter.classify({isWarpAndWeftSeparator:function(e){return s.utils.token.isLiteral(e)&&e.value==r.warpAndWeftSeparator}}),transformSyntaxTree:r.transformSyntaxTree})})}var n=t(1),a=t(8),s=t(2),i=t(5);r.exports=o},function(r,e,t){"use strict";function o(r){return r=n.extend({},r,i),n.isString(r.warpAndWeftSeparator)||(r.warpAndWeftSeparator=""),""==r.warpAndWeftSeparator&&(r.warpAndWeftSeparator=a.warpAndWeftSeparator),r.transformSyntaxTree=s.transform([r.transformSyntaxTree,s.transform.fold({allowRootReorder:!1,allowNestedBlocks:!1,maxFoldLevels:2,minBlockSize:3,greedy:!1,allowSplitStripe:!1,processExistingBlocks:!1})]),r.join=function(e){var t=[];return e.colors.length>0&&t.push(e.colors.join(" ")),e.warp!=e.weft?t.push(e.warp+" "+r.warpAndWeftSeparator+" "+e.weft):t.push(e.warp),t.join("\n")},s.render.format(r)}var n=t(1),a=t(8),s=t(2),i={format:{color:function(r){var e=""!=r.comment?" "+r.comment:"";return r.name+r.value+e+";"},stripe:function(r){return r.name+r.count},block:function(r){var e=n.chain(r.formattedItems).join(" ").trim().value();if(""==e)return"";var t=r.repeat>1?"*"+r.repeat:"";return e=r.isRoot?r.reflect?"["+e+"]":e:r.reflect?"["+e+"]":"("+e+")",e+t}}};r.exports=o},function(r,e,t){"use strict";var o=t(2);r.exports.id="stwr",r.exports.name="Scottish Register of Tartans / Scottish Tartans World Register",r.exports.parse=t(12),r.exports.format=t(13),r.exports.colors=o.utils.color.buildColorMap({K:"#000000",LP:"#9966ff",P:"#9933ff",DP:"#990099",W:"#dddddd",DW:"#e1dfd0",LY:"#ffff66",Y:"#ffff00",DY:"#ffcc00",O:"#ddaa00",LT:"#ffce24",T:"#bb5e00",DT:"#663300",LN:"#999999",N:"#666666",DN:"#333333",R:"#fd024e",LR:"#ff6262",DR:"#ce0000",MR:"#a40004",LG:"#336633",G:"#339900",DG:"#1b5300",OG:"#484e05",BG:"#074b32",AB:"#229f7a",LB:"#88a8aa",B:"#333399",DB:"#1e1e5b",RB:"#171366",NB:"#171366"}),r.exports.warpAndWeftSeparator="."},function(r,e,t){"use strict";function o(r){return r=n.extend({},r),n.isString(r.warpAndWeftSeparator)||(r.warpAndWeftSeparator=""),""==r.warpAndWeftSeparator&&(r.warpAndWeftSeparator=a.warpAndWeftSeparator),s.parse([s.parse.pivot(),s.parse.stripe(),s.parse.literal(r.warpAndWeftSeparator),s.parse.color({allowLongNames:!0,colorPrefix:/[=][#]?/,colorSuffix:null,colorFormat:"long",allowComment:!0,commentSuffix:/;/,requireCommentSuffix:!0,commentFormat:/^\s*(.*)\s*;\s*$/})],{errorHandler:r.errorHandler,processTokens:s.filter([r.processTokens,s.filter.removeTokens(s.defaults.insignificantTokens)]),buildSyntaxTree:s.syntax.classic({errorHandler:r.errorHandler,processTokens:s.filter.classify({isWarpAndWeftSeparator:function(e){return s.utils.token.isLiteral(e)&&e.value==r.warpAndWeftSeparator}}),transformSyntaxTree:r.transformSyntaxTree})})}var n=t(1),a=t(11),s=t(2);r.exports=o},function(r,e,t){"use strict";function o(r){return r.replace(/^([a-z]+)([0-9]+)$/i,"$1/$2")}function n(r){return r=a.extend({},r,l),a.isString(r.warpAndWeftSeparator)||(r.warpAndWeftSeparator=""),""==r.warpAndWeftSeparator&&(r.warpAndWeftSeparator=s.warpAndWeftSeparator),r.transformSyntaxTree=i.transform([r.transformSyntaxTree,i.transform.flatten(),i.transform.fold({allowRootReorder:!1,allowNestedBlocks:!1,maxFoldLevels:2,minBlockSize:3,greedy:!1,allowSplitStripe:!1,processExistingBlocks:!1})]),r.join=function(e){var t=[];return e.colors.length>0&&t.push(e.colors.join(" ")),e.warp!=e.weft?t.push(e.warp+" "+r.warpAndWeftSeparator+" "+e.weft):t.push(e.warp),t.join("\n")},i.render.format(r)}var a=t(1),s=t(11),i=t(2),l={format:{color:function(r){var e=""!=r.comment?" "+r.comment:"";return r.name+"="+r.value+e+";"},stripe:function(r){return r.name+r.count},block:function(r){var e=r.formattedItems;return r.reflect&&e.length>=2&&(e[0]=o(e[0]),e[e.length-1]=o(e[e.length-1])),a.chain(e).join(" ").trim().value()}}};r.exports=n},function(r,e,t){"use strict";var o=t(2);r.exports.id="weddslist",r.exports.name="Syntax by Weddslist (TDF)",r.exports.parse=t(15),r.exports.format=t(16),r.exports.colors=o.utils.color.buildColorMap({W:"#ffffff",TR:"#ffffe9",R:"#800000",A:"#80ffff",X:"#00ff00",D:"#404040",LG:"#80ff80",J:"#400080",Y:"#808000",U:"#ff00ff",K:"#000000",H:"#004080",G:"#008000",LB:"#8080ff",F:"#800040",T:"#00ffff",I:"#008040",E:"#c0c0c0",N:"#808080",V:"#ffff80",M:"#800080",S:"#ffff00",L:"#408000",P:"#ff0000",C:"#008080",Q:"#0000ff",B:"#000080",Z:"#ff7dff",LR:"#ff8080",O:"#804000"})},function(r,e,t){"use strict";function o(r){return r=n.extend({},r),a.parse([a.parse.stripe(),a.parse.literal("("),a.parse.literal(")"),a.parse.literal("["),a.parse.literal("]"),a.parse.color({allowLongNames:!0,colorPrefix:/[#]/,colorSuffix:null,colorFormat:"long",allowComment:!1})],{errorHandler:r.errorHandler,processTokens:a.filter([r.processTokens,a.filter.removeTokens(a.defaults.insignificantTokens)]),buildSyntaxTree:s({errorHandler:r.errorHandler,processTokens:a.filter.classify({isWarpAndWeftSeparator:null,isPivot:null,isBlockStart:null,isBlockEnd:null,isWarpStart:function(r){return a.utils.token.isLiteral(r)&&"["==r.value},isWeftStart:function(r){return a.utils.token.isLiteral(r)&&"]"==r.value},isBlockBodyStart:function(r){return a.utils.token.isLiteral(r)&&"("==r.value},isBlockBodyEnd:function(r){return a.utils.token.isLiteral(r)&&")"==r.value}}),transformSyntaxTree:r.transformSyntaxTree})})}var n=t(1),a=t(2),s=t(6);r.exports=o},function(r,e,t){"use strict";function o(r){return r=n.extend({},r,s),r.transformSyntaxTree=a.transform([r.transformSyntaxTree,a.transform.flatten(),a.transform.fold({allowRootReorder:!1,allowNestedBlocks:!1,maxFoldLevels:2,minBlockSize:3,greedy:!1,allowSplitStripe:!1,processExistingBlocks:!1})]),a.render.format(r)}var n=t(1),a=t(2),s={format:{color:function(r){return r.name+r.value},stripe:function(r){return r.name+r.count},block:function(r){var e=r.formattedItems;return r.reflect&&e.length>=3&&(e.splice(1,0,"("),e.splice(-1,0,")")),n.chain(e).join(" ").trim().value().replace(/\(\s+/g,"(").replace(/\s+\)/g,")")}},join:function(r){var e=[];r.colors.length>0&&e.push(r.colors.join(" "));var t=r.warp,o=r.weft;return""==t&&(t=o,o=""),r.warp==r.weft&&(o=""),""!=t&&e.push("[ "+t),""!=o&&e.push("] "+o),e.join("\n")}};r.exports=o}])});
//# sourceMappingURL=tartan-schema.min.js.map